<!DOCTYPE html>
<html>
    <head>
        <!-- Choose one of the two options: -->
    	<!-- Shaka Player compiled library: -->
    	<script src="https://cdn.jsdelivr.net/npm/shaka-player@4.12.4/dist/shaka-player.compiled.min.js"></script>
        <!-- Shaka Player compiled library: -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.12.4/dist/shaka-player.compiled.min.js"></script>	-->
    	<!-- Your application source: -->
    	<script>
    		var manifestUri = './output.mpd';

    		function initApp() {
    			// Install built-in polyfills to patch browser incompatibilities.
    			shaka.polyfill.installAll();

    			// Check to see if the browser supports the basic APIs Shaka needs.
    			if (shaka.Player.isBrowserSupported()) {
    				// Everything looks good!
    				initPlayer();
    			} else {
    				// This browser does not have the minimum set of APIs we need.
    				console.error('Browser not supported!');
    			}
    		}

    		function initPlayer() {
    			// Create a Player instance.
    			var video = document.getElementById('video');
    			var player = new shaka.Player(video);
    			
    			player.configure({
    				drm:{
    					clearKeys:{
    						'cd7eb9ff88f34caeb06185b00024e4c2': '63cb5f7184dd4b689a5c5ff11ee6a328'
    					}
    				},
    				abr: {
    					enabled: false
    				}
    			});

    			// Attach player to the window to make it easy to access in the JS console.
    			window.player = player;

    			// Listen for error events.
    			player.addEventListener('error', onErrorEvent);

    			// Try to load a manifest.
    			// This is an asynchronous process.
    			player.load(manifestUri).then(function() {
    				// This runs if the asynchronous load is successful.
    				console.log('The video has now been loaded!');
    				initSelector(player);
    			}).catch(onError);  // onError is executed if the asynchronous load fails.
    			
    			console.log(player.getConfiguration())
    		}
    		
    		function initSelector(player) {
    			var select = document.querySelector('.variantSelector');
    			options = player.getVariantTracks().map(variant => "<option>" + (variant['videoBandwidth'] / 1024) + "</option>").join('\n');
    			console.log(options)

    			select.innerHTML = options;
    			select.addEventListener('change', (event) => {
    				player.selectVariantTrack(player.getVariantTracks()[event.target.selectedIndex], true, 3)
    			})
    		}

    		function onErrorEvent(event) {
    			// Extract the shaka.util.Error object from the event.
    			onError(event.detail);
    		}

    		function onError(error) {
    			// Log the error.
    			console.error('Error code', error.code, 'object', error);
    		}

    		document.addEventListener('DOMContentLoaded', initApp);
    	</script>
  </head>
  <body>
    	<div>
    		<label> Select the bitrate: </label>
    		<select class='variantSelector' name="variantSelector"></select>
    		<label> Kb </label>
    	</div>
    	<video id="video"
    		   height="720"
    		   width="1280"
    		   controls autoplay></video>
  </body>
</html>